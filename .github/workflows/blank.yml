- name: Build XNB from EFFECTS for Android
        shell: pwsh
        run: |
          $EffectsPath = "EFFECTS"
          $OutDir      = "Saidaa"
          $IntDir      = "Saidaa_intermediate"

          if (!(Test-Path $EffectsPath)) { throw "Pasta n√£o encontrada: $EffectsPath" }

          New-Item -ItemType Directory -Force -Path $OutDir | Out-Null
          New-Item -ItemType Directory -Force -Path $IntDir | Out-Null

          # Agora compila TODOS os .fx
          $fxFiles = Get-ChildItem -Path $EffectsPath -Filter *.fx -File | Sort-Object FullName
          if ($fxFiles.Count -eq 0) { throw "Nenhum .fx encontrado em $EffectsPath" }

          $workingDir = (Resolve-Path ".").Path

          $buildLines = @()
          foreach ($f in $fxFiles) {
            $full = $f.FullName
            $rel = $full.Substring($workingDir.Length).TrimStart('\','/')
            $rel = $rel -replace '\\','/'
            $buildLines += "/build:$rel"
          }

          $mgcbFile = "EffectsOnly.mgcb"
          $content = @()
          $content += "/outputDir:$OutDir"
          $content += "/intermediateDir:$IntDir"
          $content += ""
          $content += "/platform:Android"
          $content += "/profile:HiDef"
          $content += ""
          $content += "/importer:EffectImporter"
          $content += "/processor:EffectProcessor"
          $content += ""
          $content += $buildLines
          $content | Set-Content -Path $mgcbFile -Encoding utf8

          Write-Host "WorkingDir : $workingDir"
          Write-Host "FX count   : $($fxFiles.Count)"
          Write-Host "OutputDir  : $OutDir"

          mgcb "/workingDir:$workingDir" /rebuild "/@:$mgcbFile"

          $src = Join-Path $OutDir "EFFECTS"
          $dst = Join-Path $OutDir "Effects"
          if (Test-Path $src) {
            if (!(Test-Path $dst)) { New-Item -ItemType Directory -Force -Path $dst | Out-Null }
            if ((Resolve-Path $src).Path -ne (Resolve-Path $dst).Path) {
              Copy-Item -Force -Path (Join-Path $src "*.xnb") -Destination $dst
            }
          }

          Get-ChildItem -Recurse -Path $OutDir | Select-Object FullName, Length
